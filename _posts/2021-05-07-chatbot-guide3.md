---
layout: post
title:  "[카카오 오픈빌더로 챗봇 만들기] 카카오 오픈빌더 챗봇 가이드 - 3(스킬 활용)"
date:   2021-05-07 14:00:00
author: Yeonjun
categories: Chatbot
comments: true
---
해당 글은 카카오 오픈빌더 챗봇 가이드 (Server Version)의 글에 스킬 활용 방법을 추가한 내용입니다.

카카오 오픈빌더에서 제공하는 다양한 기능을 스킬 서버에 적용 시켜 챗봇의 사용성을 올릴 수 있습니다.

## 1. 바로 연결 버튼

![1](/assets/2021-05-07/image1.png)

위 그림의 하단에 전체메뉴 보기, 더보기 와 같은 버튼을 **바로 연결 버튼**이라고 부릅니다.

바로 연결 버튼은 사용자에게 편리한 선택을 돕거나, 블록 간의 연결을 가능하게 해줍니다.

바로 연결 버튼을 통해서 블록 간에 연결하는 방법에 대해서 알아보겠습니다.

- block 정보 확인
    카카오 오픈빌더에서 생성한 블록은 각각의 고유한 blockId를 부여 받게 됩니다. blockId는 사용자의 발화를 스킬 서버에 전달 할 때, 전해지는 JSON 데이터에서 확인할 수 있습니다.

    사용자의 발화를 '테스트' 블록에 전달 할 때, 서버의 로그를 보면 다음과 같습니다.

    ![2](/assets/2021-05-07/image2.png)

    JSON > userRequest > block > id를 통해 '테스트' 블록의 아이디를 확인할 수 있습니다.

- 바로 연결 응답 만들기
    바로 연결 응답의 JSON 형태는 기존 template > outputs에 quickReplies 리스트를 추가하면 됩니다.
    ```python
    {
        "version": "2.0",
        "template": {
            "outputs": [
                {
                    "simpleText": {
                        "text": text
                    }
                }
            ],
			"quickReplies": [
                    {
                        "action": "block",
                        "blockId": "6061793907fb283213606972",
                        "label": "전체메뉴 보기"
                    },
										{
                        "action": "block",
                        "blockId": "606bfb9c6d5ef835a5b2a59a",
                        "label": "더보기"
                    }
                ]
        }
    }
    ```
    먼저, 서버 로그를 통해서 연결하고자 하는 블록의 id를 확인합니다.
    바로 연결 버튼을 통해 블록 간에 연결을 수행하고자 하는 경우에, action 옵션을 block으로 설정하면 됩니다. 위와 같은 JSON 응답을 반환하면 바로 연결 응답이 만들어집니다.

    사용자가 전체메뉴 보기를 클릭한다면 전체메뉴 보기 블록으로 진입하고, 더보기를 클릭한다면 더보기 블록으로 진입하게 됩니다.

## 2. 블록 간의 데이터 통신
사용자가 선택한 옵션들을 다른 블록으로 전달해야 되는 경우가 있습니다. 카카오 오픈빌더에서는 extra 옵션을 사용해 블록 간에 데이터를 통신을 지원하고 있습니다. 

제가 개발한 챗봇의 프로그램의 상세정보 조회를 예로 들겠습니다. 사용자가 프로그램 정보 조회를 통해 N개의 결과를 응답으로 받았을 경우에, 한 개의 프로그램을 선택해서 상세정보 조회를 진행할 수 있습니다.

![3](/assets/2021-05-07/image3.png)

(프로그램 정보 조회 블록과 상세정보 조회는 다른 블록임을 미리 말씀드립니다.)

상세정보 조회 버튼을 클릭 시, 프로그램 정보 조회 블록의 데이터(프로그램 아이디)를 상세정보 조회 블록에게 전달해야 합니다.

```python
{
    "action": "block",
    "label": "상세정보 조회",
    "blockId": self.block_id_list['상세정보 조회'],
    "extra": {  # lookMore 함수 호출 시 param 전달
        "pgm_id": item['objId'],
        "start_num": 0,
        "end_num": 1
    }
}
```

응답 JSON 데이터에 연결될 블록을 설정하고, extra 옵션에 데이터(pgm_id, start_num, end_num)를 담아 전달하면 다음과 같은 로그를 볼 수 있습니다.

![4](/assets/2021-05-07/image4.png)

JSON > action > clientExtra 를 통해 전달된 pgm_id, start_num, end_num을 확인할 수 있습니다. 상세정보 조회에서는 전달된 데이터를 통해 기능을 올바르게 수행할 수 있습니다.